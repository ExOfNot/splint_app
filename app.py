import streamlit as st
from datetime import datetime
import pandas as pd

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(
    page_title="–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è - –°–ø–ª–∏–Ω—Ç-—Ç–µ—Ä–∞–ø–∏—è",
    page_icon="ü¶∑",
    layout="wide"
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏
if 'diagnosis_data' not in st.session_state:
    st.session_state.diagnosis_data = {}
if 'treatment_data' not in st.session_state:
    st.session_state.treatment_data = {}
if 'goals_data' not in st.session_state:
    st.session_state.goals_data = {}

# –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
st.title("ü¶∑ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è - –°–ø–ª–∏–Ω—Ç-—Ç–µ—Ä–∞–ø–∏—è")
st.markdown("---")

# –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –§–ò–û
def validate_name(name):
    if not name.strip():
        return False, "–ü–æ–ª–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
    if ' ' not in name.strip():
        return False, "–í—ã –Ω–µ –≤–≤–µ–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª—ã!"
    parts = name.strip().split()
    if len(parts) < 2:
        return False, "–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–Ω–∏—Ü–∏–∞–ª—ã"
    return True, ""

# –°–ï–ö–¶–ò–Ø 1: –®–ê–ü–ö–ê –î–û–ö–£–ú–ï–ù–¢–ê
st.header("üìã –ó–∞–ø–æ–ª–Ω—è–µ–º —à–∞–ø–∫—É")
st.info("–ê–∫–∫—É—Ä–∞—Ç–Ω–æ –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã –∏ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã")

col1, col2 = st.columns([2, 1])

with col1:
    # –ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞
    contract_number = st.text_input(
        "–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞:",
        #value="–ê–±–≤–≥–¥–µ–∂–∑-–ò–ö/–õ–º-–ù–û–ü-—Ä—Å—Ç",
        help="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞"
    )
    
    # –î–∞—Ç–∞ –∑–∞–∫–ª—é—á–µ–Ω–∏—è
    contract_day = st.number_input(
        "–î–∞—Ç–∞ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ (—Ç–æ–ª—å–∫–æ –¥–≤–µ —Ü–∏—Ñ—Ä—ã):",
        min_value=1, max_value=31, value=datetime.now().day
    )
    
    # –ú–µ—Å—è—Ü
    months = ["—è–Ω–≤–∞—Ä—è", "—Ñ–µ–≤—Ä–∞–ª—è", "–º–∞—Ä—Ç–∞", "–∞–ø—Ä–µ–ª—è", "–º–∞—è", "–∏—é–Ω—è",
              "–∏—é–ª—è", "–∞–≤–≥—É—Å—Ç–∞", "—Å–µ–Ω—Ç—è–±—Ä—è", "–æ–∫—Ç—è–±—Ä—è", "–Ω–æ—è–±—Ä—è", "–¥–µ–∫–∞–±—Ä—è"]
    contract_month = st.selectbox(
        "–ú–µ—Å—è—Ü –∑–∞–∫–ª—é—á–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞:",
        months #,
        # value=datetime.now().month - 1  # —Ç–µ–∫—É–∫—â–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    )
    
    # –ì–æ–¥
    contract_year = st.number_input(
        "–ì–æ–¥ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ (—Ç–æ–ª—å–∫–æ –¥–≤–µ —Ü–∏—Ñ—Ä—ã):",
        min_value=20, max_value=99, value=datetime.now().year % 100
    )
    
    # –ü–∞—Ü–∏–µ–Ω—Ç
    patient_name = st.text_input(
        "–ü—Ä–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ ‚Äî –§–∞–º–∏–ª–∏—è, –∏–Ω–∏—Ü–∏–∞–ª—ã:",
        # value="–ë–∞–∫–∞–ª—å—á—É–∫ –¢.–í.",
        help="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–Ω–∏—Ü–∏–∞–ª—ã —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª"
    )
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞
    if patient_name:
        is_valid, error_msg = validate_name(patient_name)
        if not is_valid:
            st.error(f"‚ùå {error_msg}")
    
    # –î–æ–∫—Ç–æ—Ä
    doctor_name = st.text_input(
        "–ü—Ä–æ –¥–æ–∫—Ç–æ—Ä–∞ ‚Äî –§–∞–º–∏–ª–∏—è, –∏–Ω–∏—Ü–∏–∞–ª—ã:",
        # value="–ú–∏—Ö–∞–π–ª–∏—á–µ–Ω–∫–æ –í.–î.",
        help="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–Ω–∏—Ü–∏–∞–ª—ã —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª"
    )
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏ –¥–æ–∫—Ç–æ—Ä–∞
    if doctor_name:
        is_valid, error_msg = validate_name(doctor_name)
        if not is_valid:
            st.error(f"‚ùå {error_msg}")

# with col2:
#     st.info("""
#     **–ú–æ–∂–Ω–æ –∏ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω—è—Ç—å:**
#     1. –ñ–µ–ª—Ç—ã–µ –ø–æ–ª—è
#     2. –ß–µ–∫–±–æ–∫—Å—ã  
#     3. –°–µ–ª–µ–∫—Ç–æ—Ä—ã
#     """)

st.markdown("---")

# –°–ï–ö–¶–ò–Ø 2: –î–ò–ê–ì–ù–û–ó–´
st.header("üîç –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∏–∞–≥–Ω–æ–∑")

# –°—á–µ—Ç—á–∏–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
main_diagnosis_count = 0
selected_diagnoses = []

# –î–∏–∞–≥–Ω–æ–∑—ã –ö07.6 ‚Äî –±–æ–ª–µ–∑–Ω–∏ –í–ß–ù–°
st.subheader("–î–∏–∞–≥–Ω–æ–∑—ã –ö07.6 ‚Äî –±–æ–ª–µ–∑–Ω–∏ –í–ß–ù–°")

col1, col2, col3 = st.columns([3, 1, 1])
with col1:
    st.write("**–î–∏–∞–≥–Ω–æ–∑**")
with col2:
    st.write("**–û—Å–Ω–æ–≤–Ω–æ–π**")
with col3:
    st.write("**–°–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–π**")

# –°–ø–∏—Å–æ–∫ –¥–∏–∞–≥–Ω–æ–∑–æ–≤ –ö07.6
k07_diagnoses = [
    ("k07_60", "–ö07.60 ‚Äî —Å–∏–Ω–¥—Ä–æ–º –±–æ–ª–µ–≤–æ–π –¥–∏—Å—Ñ—É–Ω–∫—Ü–∏–∏ –í–ù–ß–°"),
    ("k07_61", "–ö07.61 ‚Äî ¬´—â—ë–ª–∫–∞—é—â–∞—è¬ª —á–µ–ª—é—Å—Ç—å"),
    ("k07_62", "–ö07.62 ‚Äî —Ä–µ—Ü–∏–¥–∏–≤–∏—Ä—É—é—â–∏–π –≤—ã–≤–∏—Ö –∏ –ø–æ–¥–≤—ã–≤–∏—Ö –í–ù–ß–°"),
    ("k07_63", "–ö07.63 ‚Äî –±–æ–ª—å –≤ –í–ù–ß–° –Ω–µ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤ –¥—Ä—É–≥–∏—Ö —Ä—É–±—Ä–∏–∫–∞—Ö"),
    ("k07_64", "–ö07.64 ‚Äî —Ç—É–≥–æ–ø–æ–¥–≤–∏–∂–Ω–æ—Å—Ç—å –í–ù–ß–° –Ω–µ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤ –¥—Ä—É–≥–∏—Ö —Ä—É–±—Ä–∏–∫–∞—Ö"),
    ("k07_65", "–ö07.65 ‚Äî –æ—Å—Ç–µ–æ—Ñ–∏—Ç –í–ù–ß–°"),
    ("k07_68", "–ö07.68 ‚Äî –¥—Ä—É–≥–∏–µ —É—Ç–æ—á–Ω—ë–Ω–Ω—ã–µ –±–æ–ª–µ–∑–Ω–∏"),
    ("k07_69", "–ö07.69 ‚Äî –±–æ–ª–µ–∑–Ω—å –í–ù–ß–° –Ω–µ—É—Ç–æ—á–Ω–µ–Ω–Ω–∞—è")
]

for diag_id, diag_name in k07_diagnoses:
    col1, col2, col3 = st.columns([3, 1, 1])
    with col1:
        st.write(diag_name)
    with col2:
        main_selected = st.checkbox("", key=f"{diag_id}_main")
        if main_selected:
            main_diagnosis_count += 1
            selected_diagnoses.append(("main", diag_name))
    with col3:
        secondary_selected = st.checkbox("", key=f"{diag_id}_secondary")
        if secondary_selected:
            selected_diagnoses.append(("secondary", diag_name))

st.markdown("---")

# –ê—Ä—Ç—Ä–æ–ø–∞—Ç–∏–∏, –º–∏–∞–ª–≥–∏—è
st.subheader("–ê—Ä—Ç—Ä–æ–ø–∞—Ç–∏–∏, –º–∏–∞–ª–≥–∏—è")

arthropathy_diagnoses = [
    ("m05", "M05 ‚Äî —Å–µ—Ä–æ–ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π —Ä–µ–≤–º–∞—Ç–æ–∏–¥–Ω—ã–π –∞—Ä—Ç—Ä–∏—Ç"),
    ("m08", "M08 ‚Äî —é–Ω–æ—à–µ—Å–∫–∏–π (—é–≤–µ–Ω–∞–ª—å–Ω—ã–π) –∞—Ä—Ç—Ä–∏—Ç"),
    ("m12_5", "M12.5–• ‚Äî —Ç—Ä–∞–≤–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—Ä—Ç—Ä–æ–ø–∞—Ç–∏—è –í–ù–ß–°"),
    ("m19_0", "M19.0–• ‚Äî –ø–µ—Ä–≤–∏—á–Ω—ã–π –∞—Ä—Ç—Ä–æ–∑ –í–ù–ß–°"),
    ("m79_1", "M79.1 ‚Äî –º–∏–∞–ª–≥–∏—è")
]

for diag_id, diag_name in arthropathy_diagnoses:
    col1, col2, col3 = st.columns([3, 1, 1])
    with col1:
        st.write(diag_name)
    with col2:
        main_selected = st.checkbox("", key=f"{diag_id}_main")
        if main_selected:
            main_diagnosis_count += 1
            selected_diagnoses.append(("main", diag_name))
    with col3:
        secondary_selected = st.checkbox("", key=f"{diag_id}_secondary")
        if secondary_selected:
            selected_diagnoses.append(("secondary", diag_name))

st.markdown("---")

# –†—É—á–Ω–æ–π –≤–≤–æ–¥ –¥–∏–∞–≥–Ω–æ–∑–æ–≤
st.subheader("–†—É—á–Ω–æ–π –≤–≤–æ–¥")

manual_diagnoses = [
    ("ds01", "DS01 ‚Äî –î–∏–∞–≥–Ω–æ–∑, –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤—Ä—É—á–Ω—É—é –¥–æ–∫—Ç–æ—Ä–∞–º–∏ ‚Ññ1"),
    ("ds02", "DS02 ‚Äî –î—Ä—É–≥–æ–π –¥–∏–∞–≥–Ω–æ–∑, –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤—Ä—É—á–Ω—É—é ‚Ññ2"),
    ("ds03", "DS03 ‚Äî –î–∏–∞–≥–Ω–æ–∑, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ –∏ –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤—Ä—É—á–Ω—É—é ‚Ññ3")
]

for diag_id, diag_name in manual_diagnoses:
    col1, col2, col3 = st.columns([3, 1, 1])
    with col1:
        st.write(diag_name)
    with col2:
        main_selected = st.checkbox("", key=f"{diag_id}_main")
        if main_selected:
            main_diagnosis_count += 1
            selected_diagnoses.append(("main", diag_name))
    with col3:
        secondary_selected = st.checkbox("", key=f"{diag_id}_secondary")
        if secondary_selected:
            selected_diagnoses.append(("secondary", diag_name))

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–∏–∞–≥–Ω–æ–∑–∞
if main_diagnosis_count == 0:
    st.error("‚ùå –ù–µ –≤—ã–±—Ä–∞–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∏–∞–≥–Ω–æ–∑!")
elif main_diagnosis_count > 1:
    st.error("‚ùå –í—ã–±—Ä–∞–Ω–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∏–∞–≥–Ω–æ–∑–æ–≤! –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω.")
else:
    st.success("‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –¥–∏–∞–≥–Ω–æ–∑ –≤—ã–±—Ä–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")

st.markdown("---")

# –°–ï–ö–¶–ò–Ø 3: –õ–ï–ß–ï–ù–ò–ï
st.header("üíä –ó–∞–ø–æ–ª–Ω—è–µ–º –ª–µ—á–µ–Ω–∏–µ")

st.subheader("–°–ø–ª–∏–Ω—Ç-—Ç–µ—Ä–∞–ø–∏—è —Å –ø–æ–º–æ—â—å—é:")

# –¢–∏–ø—ã —Å–ø–ª–∏–Ω—Ç–æ–≤
splint_types = [
    ("miorel", "–º–∏–æ—Ä–µ–ª–∞–∫—Å–∏—Ä—É—é—â–µ–≥–æ —Å–ø–ª–∏–Ω—Ç–∞"),
    ("stabil", "—Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É—é—â–µ–≥–æ —Å–ø–ª–∏–Ω—Ç–∞"),
    ("distr", "–¥–∏—Å—Ç—Ä–∞–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–ª–∏–Ω—Ç–∞"),
    ("anatom", "–∞–Ω–∞—Ç–æ–º–∏—á–µ—Å–∫–æ–≥–æ —Å–ø–ª–∏–Ω—Ç–∞"),
    ("manual_type", "–ø–æ–∑–∏—Ü–∏–∏, –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–π –≤—Ä—É—á–Ω—É—é")
]

selected_splints = []
for splint_id, splint_name in splint_types:
    selected = st.checkbox(splint_name, key=f"splint_{splint_id}")
    if selected:
        selected_splints.append(splint_name)

# –î–µ–ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä
deprogrammer = st.checkbox("–¥–µ–ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ—à–µ–Ω–∏—è", key="deprogrammer")

st.markdown("---")

# –¶–µ–ª—å –ª–µ—á–µ–Ω–∏—è
st.subheader("–¶–µ–ª—å –ª–µ—á–µ–Ω–∏—è (–¥–ª—è ...):")

treatment_goals = [
    ("separate", "—Ä–∞–∑–æ–±—â–µ–Ω–∏—è —Å—É—Å—Ç–∞–≤–Ω—ã—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π –í–ù–ß–°"),
    ("decompress", "–¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –í–ù–ß–°"),
    ("correct_muscles", "–∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –º—ã—à—Ü –ß–õ–û"),
    ("relax_muscles", "—Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è –º—ã—à—Ü –ß–õ–û"),
    ("position_jaw", "–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –Ω–∏–∂–Ω–µ–π —á–µ–ª—é—Å—Ç–∏"),
    ("correct_condyles", "–∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –º—ã—â–µ–ª–∫–æ–≤ –í–ù–ß–°"),
    ("reposition_discs", "—Å–æ–∑–¥–∞–Ω–∏—è —É—Å–ª–æ–≤–∏–π –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ü–∏–∏ –¥–∏—Å–∫–æ–≤ –í–ù–ß–°"),
    ("strengthen_apparatus", "—Å–æ–∑–¥–∞–Ω–∏—è —É—Å–ª–æ–≤–∏–π –¥–ª—è —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –º—ã—à–µ—á–Ω–æ-—Å–≤—è–∑–æ—á–Ω–æ–≥–æ –∞–ø–ø–∞—Ä–∞—Ç–∞ –í–ù–ß–°")
]

selected_goals = []
goal_count = 0
for goal_id, goal_name in treatment_goals:
    selected = st.checkbox(goal_name, key=f"goal_{goal_id}")
    if selected:
        selected_goals.append(goal_name)
        goal_count += 1

if goal_count == 0:
    st.error("‚ùå –ù–µ –≤—ã–±—Ä–∞–Ω–∞ —Ü–µ–ª—å!")
else:
    st.success(f"‚úÖ –í—ã–±—Ä–∞–Ω–æ —Ü–µ–ª–µ–π: {goal_count}")

st.markdown("---")

# –°–ï–ö–¶–ò–Ø 4: –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–´–ô –ü–†–û–°–ú–û–¢–†
st.header("üìÑ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–∞ –ª–µ—á–µ–Ω–∏—è")

if st.button("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è", type="primary"):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    errors = []
    
    if not patient_name.strip():
        errors.append("–ù–µ —É–∫–∞–∑–∞–Ω–æ –∏–º—è –ø–∞—Ü–∏–µ–Ω—Ç–∞")
    elif not validate_name(patient_name)[0]:
        errors.append("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è –ø–∞—Ü–∏–µ–Ω—Ç–∞")
    
    if not doctor_name.strip():
        errors.append("–ù–µ —É–∫–∞–∑–∞–Ω–æ –∏–º—è –¥–æ–∫—Ç–æ—Ä–∞")
    elif not validate_name(doctor_name)[0]:
        errors.append("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è –¥–æ–∫—Ç–æ—Ä–∞")
        
    if main_diagnosis_count != 1:
        errors.append("–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∏–∞–≥–Ω–æ–∑")
        
    if not selected_splints and not deprogrammer:
        errors.append("–ù–µ –≤—ã–±—Ä–∞–Ω —Ç–∏–ø —Å–ø–ª–∏–Ω—Ç–∞")
        
    if goal_count == 0:
        errors.append("–ù–µ –≤—ã–±—Ä–∞–Ω–∞ —Ü–µ–ª—å –ª–µ—á–µ–Ω–∏—è")
    
    if errors:
        st.error("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω. –û—à–∏–±–∫–∏:")
        for error in errors:
            st.write(f"‚Ä¢ {error}")
    else:
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è
        st.success("‚úÖ –ü–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!")
        
        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
        with st.expander("üìã –ì–æ—Ç–æ–≤—ã–π –ø–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è –¥–ª—è –ø–µ—á–∞—Ç–∏", expanded=True):
            
            # –®–∞–ø–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            st.markdown(f"""
            **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫ –¥–æ–≥–æ–≤–æ—Ä—É –æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —É—Å–ª—É–≥ ‚Ññ {contract_number}**  
            –æ—Ç ¬´{contract_day}¬ª {contract_month} 20{contract_year} –≥.
            
            ### –ü–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è
            
            **–î–∞—Ç–∞:** {datetime.now().strftime("%d.%m.%Y")}  
            **–ü–∞—Ü–∏–µ–Ω—Ç:** {patient_name}
            """)
            
            # –î–∏–∞–≥–Ω–æ–∑—ã
            main_diag = [diag[1] for diag in selected_diagnoses if diag[0] == "main"]
            secondary_diag = [diag[1] for diag in selected_diagnoses if diag[0] == "secondary"]
            
            if main_diag:
                st.markdown(f"**–î–∏–∞–≥–Ω–æ–∑:** {main_diag[0]}")
            
            if secondary_diag:
                st.markdown(f"**–°–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–π –¥–∏–∞–≥–Ω–æ–∑:** {'; '.join(secondary_diag)}")
            
            # –õ–µ—á–µ–Ω–∏–µ
            treatment_text = "—Å–ø–ª–∏–Ω—Ç-—Ç–µ—Ä–∞–ø–∏—è —Å –ø–æ–º–æ—â—å—é "
            if selected_splints:
                treatment_text += ", ".join(selected_splints)
            if deprogrammer:
                if selected_splints:
                    treatment_text += ", —Å –¥–µ–ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä–æ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ—à–µ–Ω–∏—è"
                else:
                    treatment_text += "–¥–µ–ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ—à–µ–Ω–∏—è"
            
            st.markdown(f"**–õ–µ—á–µ–Ω–∏–µ:** {treatment_text}")
            
            if selected_goals:
                goals_text = "; ".join(selected_goals)
                st.markdown(f"**–¥–ª—è** {goals_text}.")
            
            # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            st.markdown("""
            **–†–µ–∂–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**  
            —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–ø–ø–∞—Ä–∞—Ç–∞ –≤–æ –≤—Ä–µ–º—è –æ–±–æ—Å—Ç—Ä–µ–Ω–∏–π –∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –º–∏–æ–≥–∏–º–Ω–∞—Å—Ç–∏–∫–∏.
            
            –ù–∞ —ç—Ç–∞–ø–µ —Å–ø–ª–∏–Ω—Ç-—Ç–µ—Ä–∞–ø–∏–∏ –≤–æ–∑–º–æ–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –≤—ã—Å–æ—Ç—ã –∏ –æ–∫–∫–ª—é–∑–∏–æ–Ω–Ω–æ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –∞–ø–ø–∞—Ä–∞—Ç–∞ –ø—É—Ç–µ–º –ø–µ—Ä–µ–±–∞–∑–∏—Ä–æ–≤–∫–∏. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∞–ø–ø–∞—Ä–∞—Ç –±—É–¥–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –≤ –∑—É–±–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é.
            
            –ü–æ—Å–ª–µ 3 –º–µ—Å—è—Ü–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–∫–∫–ª—é–∑–∏–æ–Ω–Ω–æ–≥–æ –∞–ø–ø–∞—Ä–∞—Ç–∞ ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –º—ã—à—Ü —á–µ–ª—é—Å—Ç–Ω–æ-–ª–∏—Ü–µ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏ –∏ –≤–∏—Å–æ—á–Ω–æ-–Ω–∏–∂–Ω–µ—á–µ–ª—é—Å—Ç–Ω–æ–≥–æ —Å—É—Å—Ç–∞–≤–∞ (–ú–†–¢ –í–ù–ß–°). –í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π –¥–∏–Ω–∞–º–∏–∫–∏ –∏–ª–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤ –¥–∏—Å—Ñ—É–Ω–∫—Ü–∏–∏ –í–ù–ß–° –∏ –º—ã—à—Ü –ß–õ–û –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–º–µ–∂–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ (–æ—Å—Ç–µ–æ–ø–∞—Ç–∞, –Ω–µ–≤—Ä–æ–ª–æ–≥–∞, —á–µ–ª—é—Å—Ç–Ω–æ-–ª–∏—Ü–µ–≤–æ–≥–æ —Ö–∏—Ä—É—Ä–≥–∞, –ø—Å–∏—Ö–∏–∞—Ç—Ä–∞). –ö—Ä–æ–º–µ —ç—Ç–æ–≥–æ, –ø–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω.
            
            –ü—Ä–∏ —É—Å–∏–ª–µ–Ω–∏–∏ —Å–∏–º–ø—Ç–æ–º–æ–≤ –≥–∏–ø–µ—Ä—Ç–æ–Ω—É—Å–∞ –º—ã—à—Ü —á–µ–ª—é—Å—Ç–Ω–æ-–ª–∏—Ü–µ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω–∞—è –¥–µ–ø—Ä–æ–≥—Ä–∞–º–º–∞—Ü–∏—è –º—ã—à—Ü –≤ –∫–ª–∏–Ω–∏–∫–µ, –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –∫–æ–º–ø–ª–µ–∫—Å–∞ –º–∏–æ–≥–∏–º–Ω–∞—Å—Ç–∏–∫–∏, —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ–π–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞ —Ç–∞–∫–∂–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–º–µ–∂–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤.
            
            **–ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Å–ø–ª–∏–Ω—Ç —Ç–µ—Ä–∞–ø–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ:**  
            –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–ö–õ–ö–¢, –ú–†–¢ –í–ù–ß–°, –∞–∫—Å–∏–æ–≥—Ä–∞—Ñ–∏—è, –º–∏–æ–≥—Ä–∞—Ñ–∏—è, —Ü–∏—Ñ—Ä–æ–≤–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–∫–∫–ª—é–∑–∏–æ–Ω–Ω–æ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –∑—É–±–æ–≤); –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–ø–ø–∞—Ä–∞—Ç–∞ —Å –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º (—Å–ø–ª–∏–Ω—Ç-–∫–∞–Ω–∏–∫—É–ª—ã) –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π –ø–ª–∞–Ω–∞ –ª–µ—á–µ–Ω–∏—è.
            
            –í —Å–ª—É—á–∞–µ —É—Ç–µ—Ä–∏ –∞–ø–ø–∞—Ä–∞—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑–≥–æ—Ç–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π, –æ–ø–ª–∞—Ç–∏–≤ –µ–≥–æ –ø–æ–ª–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å. –í —Å–ª—É—á–∞–µ –ø–æ–ª–æ–º–∫–∏ –∞–ø–ø–∞—Ä–∞—Ç–∞ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –µ–≥–æ —Ä–µ–º–æ–Ω—Ç (–µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ). –ì–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π —Å—Ä–æ–∫ —Å–ª—É–∂–±—ã –¥–ª—è –æ–∫–∫–ª—é–∑–∏–æ–Ω–Ω—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–æ–≤ (—Å–ø–ª–∏–Ω—Ç–æ–≤) –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω.
            """)
            
            # –ü–æ–¥–ø–∏—Å–∏
            st.markdown(f"""
            ---
            **–ü–∞—Ü–∏–µ–Ω—Ç:** _________________ / {patient_name} /  
            **–í—Ä–∞—á:** _________________ / {doctor_name} /  
            """)

# –ü–æ–¥–≤–∞–ª
st.markdown("---")
st.caption("¬© –û–§–° –°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è, https://ofs.team/")
st.caption("–°–∏—Å—Ç–µ–º–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–µ—á–µ–Ω–∏—è ‚Ä¢ –í–µ—Ä—Å–∏—è 1.0")
